<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Swift Transport Booking</title>
    <style>
        /* Your existing styles */
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #2c2c2c; /* Dark mode background */
            color: #fff; /* Light text for better contrast */
        }
        /* ... (rest of your existing styles) */
    </style>
    <script>
        // Function to fetch user data from Google Sheets by ID
        function fetchUserData() {
            var userId = document.getElementById('userId').value;
            google.script.run.withSuccessHandler(fillUserData).getUserData(userId);
        }

        // Function to fill the form with user data retrieved from Google Sheets
        function fillUserData(data) {
            if (data) {
                document.getElementById('name').value = data.name;
                document.getElementById('phone').value = data.phone;
                document.getElementById('balance').innerText = `Balance: $${data.balance.toFixed(2)}`;
                
                // Show tier discount button based on the user's tier
                var discountButton = document.getElementById('applyDiscountBtn');
                if (data.tier === 'Gold') {
                    discountButton.innerText = 'Apply 5% Discount';
                    discountButton.style.display = 'block';
                } else if (data.tier === 'Platinum') {
                    discountButton.innerText = 'Apply 10% Discount';
                    discountButton.style.display = 'block';
                } else {
                    discountButton.style.display = 'none'; // Silver tier or no discount
                }
            } else {
                alert("User not found. Please enter a valid ID.");
            }
        }

        // Function to handle booking confirmation
        function confirmBooking() {
            var userId = document.getElementById('userId').value;
            var fare = parseFloat(document.getElementById('fareDisplay').innerText.replace('Total Fare: $', ''));

            // Update the balance and apply any referrals
            google.script.run.updateUserBalance(userId, fare, document.getElementById('referrerId').value);
            alert("Booking confirmed. Balance updated!");
        }
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBsqYdVFXJcuUpxwkIEPJxEAGN2jlf-tT4&libraries=places"></script>
</head>
<body>
    <h1>Book Your Ride</h1>
    
    <!-- Input for User ID to auto-fill user data from Google Sheets -->
    <label for="userId">Enter Your User ID:</label>
    <input type="text" id="userId" oninput="fetchUserData()">

    <!-- Your existing booking form -->
    <form id="bookingForm">
        <label for="name">Your Name:</label>
        <input type="text" id="name" name="name" readonly>

        <label for="phone">Phone Number:<small>(Needed for further confirmations from the driver)</small></label>
        <input type="text" id="phone" name="phone" readonly>

        <label for="pickupTime">Pickup Time (HH:MM):</label>
        <input type="time" id="pickupTime" name="pickupTime" required>

        <label for="pickupDate">Pickup Date:</label>
        <input type="date" id="pickupDate" name="pickupDate" required>

        <label for="pickupLocation">Pickup Location:</label>
        <input type="text" id="pickupLocation" name="pickupLocation" required>

        <label for="dropoffLocation">Drop-off Location:</label>
        <input type="text" id="dropoffLocation" name="dropoffLocation" required>

        <!-- Fare display and confirmation buttons -->
        <button type="submit" id="confirmInfoBtn" class="blinking">Confirm Info</button>
        <div id="fareContainer" class="fare-container" style="display: none;">
            <div id="fareDisplay" class="fare"></div>
            <div id="fareBreakdown" class="fare-description"></div>
            <div class="tip-options" id="tipOptions">
                <button type="button" id="tip15">Tip 15%</button>
                <button type="button" id="tip20">Tip 20%</button>
                <button type="button" id="tip25">Tip 25%</button>
            </div>
            <button type="button" id="confirmRideBtn" class="confirm-ride-btn" disabled>Confirm Ride!</button>
            <button type="button" id="cancelBtn" class="cancel-btn" disabled>Cancel</button>
        </div>

        <!-- Display balance fetched from Google Sheets -->
        <div id="balance"></div>

        <!-- Button to apply discount based on user's tier -->
        <button id="applyDiscountBtn" style="display:none" onclick="applyDiscount()">Apply Discount</button>
    </form>

    <div class="eta" id="etaDisplay"></div>
    <div id="map"></div>

    <!-- Share via SMS section (your existing code) -->
    <div id="shareSection">
        <h2>Enjoy our great prices? Please tell a friend about us. Thanks for your support!</h2>
        <button id="shareSMSBtn">Share via SMS</button>
    </div>

    <!-- Rest of your existing JavaScript code for map, ride, etc. -->
    <script>
        // Your existing JavaScript code for calculating fare, confirming booking, etc.
    </script>
</body>
</html>
