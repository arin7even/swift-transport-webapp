<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Swift Transport Booking</title>
    <style>
        /* (Your existing styles go here) */
    </style>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBsqYdVFXJcuUpxwkIEPJxEAGN2jlf-tT4&libraries=places"></script>
</head>
<body>
    <h1>Book Your Ride</h1>
    <form id="bookingForm">
        <!-- Your input fields (Name, Phone, Pickup, Dropoff, etc.) -->

        <label for="name">Your Name:</label>
        <input type="text" id="name" name="name" required>

        <label for="phone">Phone Number:</label>
        <input type="text" id="phone" name="phone" required>
		
        <label for="referralCode">Referral Code (Optional):</label>
        <input type="text" id="referralCode" name="referralCode">

        <label for="pickupTime">Pickup Time:</label>
        <input type="time" id="pickupTime" name="pickupTime" required>

        <label for="pickupDate">Pickup Date:</label>
        <input type="date" id="pickupDate" name="pickupDate" required>

        <label for="pickupLocation">Pickup Location:</label>
        <input type="text" id="pickupLocation" name="pickupLocation" required>

        <label for="dropoffLocation">Drop-off Location:</label>
        <input type="text" id="dropoffLocation" name="dropoffLocation" required>

        <button type="submit" id="confirmInfoBtn" class="blinking">Confirm Info</button>

        <div id="fareContainer" style="display: none;">
            <!-- Fare Breakdown, Balance, Referral Info, etc. -->
        </div>
    </form>

    <div id="map"></div>

    <script>
        let baseFare = 10.00;
        let totalFare = 0;

        function initMap() {
            // Your existing map code
        }

        document.getElementById('confirmInfoBtn').addEventListener('click', async function(event) {
            event.preventDefault();

            const name = document.getElementById('name').value;
            const phone = document.getElementById('phone').value;
            const userID = name + phone.slice(-4);  // Example user ID generation

            // Fetch user data
            const response = await fetch(`https://script.google.com/macros/s/AKfycbyDZ1-77fYE2kflnlvWYjeIJi3E75IaJ7wP2CCLsAGVm0sUfeLdQQNzVIIQQ19LG2TF_g/exec?userID=${userID}`);
            const userInfo = await response.json();

            if (userInfo) {
                // Existing user: Display the info
                document.getElementById('referralCode').innerText = userInfo.userID;
                document.getElementById('userTier').innerText = `${userInfo.userTier} (${userInfo.tierDiscount})`;
                document.getElementById('referralCount').innerText = userInfo.referralCount;
                document.getElementById('referralEarnings').innerText = `$${userInfo.referralEarnings}`;
                document.getElementById('ridesEarnings').innerText = `$${userInfo.ridesEarnings}`;
                document.getElementById('totalBalance').innerText = `$${userInfo.totalBalance}`;
            } else {
                // New user: Handle new user creation
                const newUser = {
                    userID, name, phone, rides: 0, totalPaid: 0,
                    ridesEarnings: 0, referralEarnings: 0,
                    balanceExpiry: '', referralCode: userID, referralCount: 0,
                    tipsPaid: 0, userTier: 'Silver', tierDiscount: '0%'
                };

                await fetch('https://script.google.com/macros/s/AKfycbyDZ1-77fYE2kflnlvWYjeIJi3E75IaJ7wP2CCLsAGVm0sUfeLdQQNzVIIQQ19LG2TF_g/exec', {
                    method: 'POST',
                    body: JSON.stringify(newUser)
                });
                alert('New user created.');
            }

            // (Handle fare calculation and map updates)
        });

        window.onload = function() {
            initMap();
        };
    </script>
</body>
</html>
